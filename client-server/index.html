<!doctype html>
<html>

<head>
    <title>Exjobb</title>
    <script src="https://code.jquery.com/jquery-1.11.2.min.js"></script>
    <script src="https://cdn.socket.io/socket.io-1.2.0.js"></script>

    <script>
    var socket = io();

    //create the canvas

    var ctx;
    var x = 50;
    var y = 50;
    var dx = 1;
    var dy = 1;
    var canvasHeight = 100;
    var canvasWidth = 150;
    var cubeSize = 20;
    var heroID;
    var theArray = [];

    var started;
    var iPressed = false;
    var i = 0;
    var theInterval;
    var theOutputString="";




    function init() {
        var canvas = document.createElement("canvas");
        ctx = canvas.getContext("2d");
        canvas.width = canvasWidth;
        canvas.height = canvasHeight;
        document.body.appendChild(canvas);

        // Game objects




    }

    function draw() {

    	if (performance.now()-started > 10000 && iPressed == true) {
    		var a = window.document.createElement('a');
    		for (var j = 1; j < theArray.length; j++) {
    			theOutputString += theArray[j].toString() + "\n";
    		};
		    a.href = window.URL.createObjectURL(new Blob([theOutputString], {
		        type: 'text/csv'
		    }));
		    a.download = 'statistic.csv';
		    document.body.appendChild(a);
		    a.click();
		    document.body.removeChild(a);
		    clearInterval(theInterval);
    	};

        ctx.clearRect(0, 0, canvasWidth, canvasHeight);
        ctx.beginPath();
        ctx.fillStyle = "#0000ff";
        ctx.rect(x, y, cubeSize, cubeSize);
        ctx.closePath();
        ctx.fill();

        if (x < 0 || x + cubeSize > canvasWidth) dx = -dx;
        if (y < 0 || y + cubeSize > canvasHeight) dy = -dy;
        x += dx;
        y += dy;

		
       i++;
        //Update my palyers position on the server
        socket.emit('updatePlayerPos', {
            "id": heroID,
            "x": x,
            "y": y,
            "t": i/*,
            "t": Date.now()*/
        });
        theArray[i] = performance.now();
         

    }



    socket.on('serverUpdatePlayerPos', function(msg) {
        if (msg.id !== heroID) {
            ctx.beginPath();
            ctx.fillStyle = "#ff00ff";
            ctx.rect(msg.x, msg.y, cubeSize, cubeSize);
            ctx.closePath();
            ctx.fill();
            enemyY = msg.y;
            enemyX = msg.x;
            /*console.log(msg.id);*/
        }
        else{
        	theArray[msg.t] = performance.now() - theArray[msg.t];
        }

    });

    socket.on('connected', function(msg) {
        /*console.log(msg);*/
        heroID = socket.io.engine.id;

    });

    socket.on('startshit', function(msg) {
    	started = performance.now();
        theInterval = setInterval(draw, 1000 / 30);
    });

    socket.on('disconnected', function(msg) {

    });

    function doABarrelRoll(){
    	iPressed = true;
    	socket.emit('doABarrelRoll', 'Nu k√∂r vi!');
    }
    </script>
</head>

<body onload="init();">
<button onclick="doABarrelRoll();">FIREEEEEEEE</button>

</body>

</html>
