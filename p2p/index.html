<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Datachannel test</title>
	<script src="https://cdn.firebase.com/js/client/2.2.2/firebase.js"></script>
	<script src="webrtc.js"> </script>
	<script src="spelet.js"> </script>
</head>

<script>
	
	var ctx;
    var x = 50;
    var y = 50;
    var dx = 1;
    var dy = 1;
    var canvasHeight = 100;
    var canvasWidth = 150;
    var cubeSize = 20;
    var heroID;

    var started;
    var iPressed = false;
    var i = 0;
    var theInterval;
    var theOutputString="";



    function init() {
        var canvas = document.createElement("canvas");
        ctx = canvas.getContext("2d");
        canvas.width = canvasWidth;
        canvas.height = canvasHeight;
        document.body.appendChild(canvas);


    }

    function draw() {

    	/*if (performance.now()-started > 10000 && iPressed == true) {
    		var a = window.document.createElement('a');
    		for (var j = 1; j < theArray.length; j++) {
    			theOutputString += theArray[j].toString() + "\n";
    		};
		    a.href = window.URL.createObjectURL(new Blob([theOutputString], {
		        type: 'text/csv'
		    }));
		    a.download = 'statistic.csv';
		    document.body.appendChild(a);
		    a.click();
		    document.body.removeChild(a);
		    clearInterval(theInterval);
    	};*/

        ctx.clearRect(0, 0, canvasWidth, canvasHeight);
        ctx.beginPath();
        ctx.fillStyle = "#0000ff";
        ctx.rect(x, y, cubeSize, cubeSize);
        ctx.closePath();
        ctx.fill();

        if (x < 0 || x + cubeSize > canvasWidth) dx = -dx;
        if (y < 0 || y + cubeSize > canvasHeight) dy = -dy;
        x += dx;
        y += dy;

		
       i++;
        //Update my palyers position on the server

        for (var j = 0; j < connectedPeers.length; j++) {
    		connectedPeers[j].send(JSON.stringify({
    		            "id": id,
    		            "x": x,
    		            "y": y,
    		            "t": i
    		        }));
    	};
       
       /* theArray[i] = performance.now();*/
         

    }


     function doABarrelRoll(){
    	iPressed = true;
    	for (var i = 0; i < connectedPeers.length; i++) {
    		connectedPeers[i].send("barrelRoll");
    	};
    	setInterval(draw, 1000 / 30);
    	
    }
</script>
<body onload="init();">
<button onclick="doABarrelRoll();">FIREEEEEEEE</button>

</body>
</html>